generator client {
  provider = "prisma-client"
  output   = "./generated"
}
datasource db {
  provider = "postgresql"
}

model Person {
  id         Int           @id @default(dbgenerated("1000000 + floor(random() * 9000000)::int"))
  rfid_uuid  String        @unique
  type       PersonType
  nom        String
  prenom     String
  photo_path String?       @unique
  level      StudentLevel?
  class      String?
  created_at DateTime      @default(now())
  updated_at DateTime      @updatedAt

  attendance       Attendance[]
  student_payments StudentPayment[]

  @@map("persons")
}

model Attendance {
  id              Int              @id @default(autoincrement())
  person_id       Int
  action          AttendanceAction
  status          AttendanceStatus
  attendance_date DateTime         @default(now())

  person Person @relation(fields: [person_id], references: [id])

  @@map("attendance")
}

model Payment {
  id             Int           @id @default(autoincrement())
  amount         Float
  payment_method PaymentMethod
  payment_date   DateTime      @default(now())

  student_payments StudentPayment[]

  @@map("payments")
}

model StudentPayment {
  id         Int @id @default(autoincrement())
  student_id Int
  payment_id Int
  trimester  Int

  student Person  @relation(fields: [student_id], references: [id], onDelete: Cascade)
  payment Payment @relation(fields: [payment_id], references: [id])

  @@map("student_payments")
}

enum PersonType {
  student
  teacher
  staff
  visitor
}

enum AttendanceAction {
  in
  out
}

enum AttendanceStatus {
  success
  failed
}

enum PaymentMethod {
  cash
  card
  bank_transfer
}

enum StudentLevel {
  License_1
  License_2
  License_3
  Master_1
  Master_2
}
